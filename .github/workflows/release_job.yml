name: Build external contracts

# Controls when the action will run. Triggers the workflow on push or pull request
# events but only for the main branch
on:
  push:
    branches: [ main ]

# A workflow run is made up of one or more jobs that can run sequentially or in parallel
jobs:
  # This workflow contains a single job called "build"
  build:
    # The type of runner that the job will run on
    runs-on: ubuntu-latest
    
    steps:
        - uses: actions/checkout@v2
        - name: Set up JDK 1.8
          uses: actions/setup-java@v1
          with:
            java-version: 1.8
            server-id: bintray-aredzo-mtracker
            server-username: BINTRAY_USERNAME
            server-password: BINTRAY_API_KEY
        - name: Build with Maven
          run: mvn -B package --file pom.xml
          
        - name: Publish package on bintray
          run: mvn -B deploy
          env:
            BINTRAY_USERNAME: "aredzo"
            BINTRAY_API_KEY: ${{ secrets.BINTRAY_KEY }}
        - name: Publish package on github packages
          run: mvn -B deploy -Dregistry=https://maven.pkg.github.com/aredzo -Dtoken=${{secrets.GITHUB_TOKEN}}
