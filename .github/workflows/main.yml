name: Build external contracts

# Controls when the action will run. Triggers the workflow on push or pull request
# events but only for the main branch
on:
  push:
    branches: [ develop ]
  pull_request:
    branches: [ main, develop ]

# A workflow run is made up of one or more jobs that can run sequentially or in parallel
jobs:
  # This workflow contains a single job called "build"
  build:
    # The type of runner that the job will run on
    runs-on: ubuntu-latest
    
    steps:
        - uses: actions/checkout@v2
        - name: Set up JDK 1.8
          uses: actions/setup-java@v1
          with:
            java-version: 1.8
        - name: Build with Maven
          run: mvn -B package --file pom.xml
        - name: Copy artifacts
          run: mkdir staging && cp target/*.jar staging
        - name: Upload package with contracts to Bintray
          uses: bpicode/github-action-upload-bintray@master
          with:
            file: ./mkdir/*.jar
            api_user: example-user
            api_key: ${{ secrets.BINTRAY_KEY }} # An API key can be obtained from the user profile page.
            repository_user: aredzo
            repository: mtracker
            package: mtracker-sso-external
            version: '0.0.1'
            publish: 1
            calculate_metadata: true # Schedule metadata calculation after upload
